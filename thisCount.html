<!-- testing with this.count to have updateCount function -->
<html>
	<head>
    	<meta charset="utf-8" />
	</head>
	<body>
		<h1>rest of page</h1>
	</body>
	<script src="node_modules/proto/dist/proto.umd.js"></script>
	<script src="node_modules/gem/dist/Gem.umd.js"></script>
	<script src="https://tixit.me/ExtensionTester.umd.js"></script>
	<script>
		var HelloWorld = proto(Gem, function(superclass){
			this.name = 'HelloWorld'
			this.build = function(ticket, optionsObservee, api){
				var that = this
				this.ticket = ticket
			// Step 4
				optionsObservee = {subject:optionsObservee} // todo: remove this when Tixit is deployed next
				var prop = optionsObservee.subject.countField
				this.count = ticket.subject[prop]
			// Step 2 - create greeting, make it invisible and add button
				var greeting = Gem.Text('greeting', 'Hello World')
				var button = Gem.Button('click me')
			// Step 3 - create text to show number of times button clicked, make it invisible, and add it
				this.countText = Gem.Text('x')	
				var box = Gem.Block('box', greeting, button, this.countText)
				this.add(box)
			// Step 4 - no text if count undefined
				if(this.count == undefined){
					greeting.visible = false
					this.countText.visible = false
					this.count = 0
				}
				this.changeCount()
			// Step 2 - show greeting on click
				button.on('click', function(){
					var newGreeting = ['Hello World', 'Hi There', 'Howdy', 'Hello', 'Hey']
					greeting.text = newGreeting[that.count%newGreeting.length]
					greeting.visible = true
				// Step 3 - increase count and show number of times button clicked
					// countText.text = 'You have clicked this button ' + that.count + ' times.'
					// that.count++
					that.changeCount()
					// that.countText.visible = true
					console.log('after ' + that.count)
				// Step 4 - Updates count in test Editor box
					ticket.set('count', that.count)
				})

			// Step 4 - Updates count when count changed in Editor box
				ticket.get('count').on('change', function(){
					this.count = ticket.subject.count
					console.log('get ' + this.count)
					that.countText.text = 'You have clicked this button ' + this.count + ' times.'
				})
			}
			this.changeCount = function(){
				console.log('changeCount function ' + this.count)
				this.count++
				this.countText.text = 'You have this clicked this button ' + this.count + ' times.'
				this.countText.visible =true
			}
			this.getStyle = function(){
				return Gem.Style({
					$box: {
						width: 250,
						minHeight: 100,
						border: '1px solid black',
						padding: 5
					},
					$greeting: {
						color: 'blue',
						fontSize: 24,
						display: 'block',
						margin: 10
					},
					Button: {
						backgroundColor: 'green',
						color: 'white',
						display:'block',
						margin: 10
					}
				})
			}
		})

		ExtensionTester.Api.Ticket.create().then(function(newOne){
		// Step 4 - 
			// newOne.subject.count = '10'
			ExtensionTester(HelloWorld, {countField: 'count'}, {ticketId: newOne.subject._id, showEditor: true})
		}).done()
	</script>
</html>